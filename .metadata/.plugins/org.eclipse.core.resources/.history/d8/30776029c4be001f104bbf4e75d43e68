package Client;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.net.Socket;
import java.util.Scanner;

public class Client {

    public static void main(String args[]) {
        System.out.printf(" ---------------\n");
        System.out.printf("| General Store |");
        System.out.printf("\n ---------------\n");

        final String SERVER_IP = "127.0.0.1";
        final int SERVER_PORT = 6789;

        try (Socket socket = new Socket(SERVER_IP, SERVER_PORT);
             DataInputStream input = new DataInputStream(socket.getInputStream());
             DataOutputStream output = new DataOutputStream(socket.getOutputStream());
             Scanner scanner = new Scanner(System.in)) {

            System.out.println("Connected to the server!");

            while (true) {
                System.out.println("Choose an option:\n1. Login \n2. SignUp \n3. Exit");
                String choice = scanner.nextLine();

                switch (choice) {
                    case "1":
                        output.writeUTF("Login");
                        output.flush();

                        System.out.print("Insert email: ");
                        String email = scanner.nextLine();
                        System.out.print("Insert password: ");
                        String password = scanner.nextLine();

                        output.writeUTF(email);
                        output.writeUTF(password);
                        output.flush();

                        String serverResponse = input.readUTF();
                        if (serverResponse.equals("LoginSuccessful")) {
                            String welcomeMessage = input.readUTF();
                            System.out.println(welcomeMessage);

                            // Second menu
                            while (true) {
                                System.out.println("Choose an option:\n1. View Products \n2. Buy Products \n3. Suggest New Product \n4. Exit");
                                String choiceSecondMenu = scanner.nextLine();

                                switch (choiceSecondMenu) {
                                    

                                    case "2":
                                        System.out.println("--- Buy Products ---");
                                        // Implement purchase logic here
                                        break;

                                    case "3":
                                        System.out.println("--- Suggest New Product ---");
                                        // Implement product suggestion logic here
                                        break;

                                    case "4":
                                        System.out.println("--- Exit to General Store ---");
                                        output.writeUTF("CloseConnection");
                                        output.flush();
                                        System.out.println("Connection closed");
                                        return;
                                    case "1":
                                        output.writeUTF("ViewProducts");
                                        output.flush();

                                        String response = input.readUTF();
                                        if (response.equals("correct")) {
                                            System.out.println("--- List of Products ---");
                                            System.out.println("------------------------------------------------");
                                            System.out.println("NAME\t | \tPRICE\t | \tQUANTITY");
                                            System.out.println("------------------------------------------------");

                                            while (true) {
                                                String productIndicator = input.readUTF();
                                                if (productIndicator.equals("Stop")) {
                                                    System.out.println("End of product list.\n");
                                                    break;
                                                }

                                                if (productIndicator.equals("Product")) {
                                                    String name = input.readUTF();
                                                    float price = input.readFloat();
                                                    int quantity = input.readInt();
                                                    System.out.printf("%s\t | \t%.2f\t | \t%d\n", name, price, quantity);
                                                } else {
                                                    System.out.println("Unexpected data received: " + productIndicator);
                                                }
                                            }
                                        } else {
                                            System.out.println("Error retrieving product list!\n");
                                        }
                                        break;

                                    default:
                                        System.out.println("Invalid option! Please try again.\n");
                                }
                            }

                        } else if (serverResponse.equals("LoginFailed")) {
                            System.out.println("Error wrong email or password! Try again.");
                        } else if (serverResponse.equals("ServerError")) {
                            System.out.println("Server error! Try again later.");
                        }

                        break;

                    case "2":
                        output.writeUTF("SignUp");
                        output.flush();

                        System.out.println("Insert user details: ");
                        System.out.print("Name: ");
                        output.writeUTF(scanner.nextLine());
                        System.out.print("Surname: ");
                        output.writeUTF(scanner.nextLine());
                        System.out.print("Email: ");
                        output.writeUTF(scanner.nextLine());
                        System.out.print("Password: ");
                        output.writeUTF(scanner.nextLine());
                        System.out.print("Address: ");
                        output.writeUTF(scanner.nextLine());
                        System.out.print("City: ");
                        output.writeUTF(scanner.nextLine());
                        output.flush();

                        serverResponse = input.readUTF();
                        System.out.println("Server's answer: " + serverResponse);
                        break;

                    case "3":
                        output.writeUTF("CloseConnection");
                        output.flush();
                        System.out.println("Connection closed");
                        return;

                    default:
                        System.out.println("Option not valid!");
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
